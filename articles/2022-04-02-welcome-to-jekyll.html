<!DOCTYPE html>

<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
  
    <link rel="shortcut icon" href="/favicon.png?v=0.0.1" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css?v=0.0.1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300&family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>What You Should Know About The Django User Model | Aspire to Inspire</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="What You Should Know About The Django User Model" />
<meta name="author" content="https://www.linkedin.com/in/sbalne/" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Stories about Python, AWS and Terraform" />
<meta property="og:description" content="Stories about Python, AWS and Terraform" />
<link rel="canonical" href="https://sreekanthreddybalne.github.io/articles/2022-04-02-welcome-to-jekyll.html" />
<meta property="og:url" content="https://sreekanthreddybalne.github.io/articles/2022-04-02-welcome-to-jekyll.html" />
<meta property="og:site_name" content="Aspire to Inspire" />
<meta property="og:image" content="https://simpleisbetterthancomplex.com/media/2021/07/featured-user.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-02T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://simpleisbetterthancomplex.com/media/2021/07/featured-user.jpg" />
<meta property="twitter:title" content="What You Should Know About The Django User Model" />
<meta name="twitter:site" content="@s_balne" />
<meta name="twitter:creator" content="@https://www.linkedin.com/in/sbalne/" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"https://www.linkedin.com/in/sbalne/"},"dateModified":"2022-04-02T00:00:00+00:00","datePublished":"2022-04-02T00:00:00+00:00","description":"Stories about Python, AWS and Terraform","headline":"What You Should Know About The Django User Model","image":"https://simpleisbetterthancomplex.com/media/2021/07/featured-user.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://sreekanthreddybalne.github.io/articles/2022-04-02-welcome-to-jekyll.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://sreekanthreddybalne.github.io/assets/media/logo.png"},"name":"https://www.linkedin.com/in/sbalne/"},"url":"https://sreekanthreddybalne.github.io/articles/2022-04-02-welcome-to-jekyll.html"}</script>
<!-- End Jekyll SEO tag -->

<link type="application/atom+xml" rel="alternate" href="https://sreekanthreddybalne.github.io/feed.xml" title="Aspire to Inspire" />
  </head>
<body>
    <header>
    <nav class="container">
        <ul class="menu menu-left brand">
            <li class="logo">
                <a href="/" style="font-weight: 600">aspire<span class="brand">to</span>inspire</a>
            </li>
        </ul>
        <ul class="menu menu-left">
            
            <li class="menu-item">
                <a href="/" >
                    <span class="fa fa-home"></span>
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/articles" >
                    <span class="fa fa-archive"></span>
                    Articles
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/feed.xml" >
                    <span class="fa fa-rss"></span>
                    RSS
                </a>
            </li>
            
        </ul>
        <ul class="menu ml-auto">
            <li class="menu-item">
                <a href="/hire-me">
                    <span class="fa fa-certificate"></span> Hire me!
                </a>
            </li>
        </ul>
        <ul class="menu ml-auto nav-toggle">
            <li class="menu-item">
                <a href="javascript:void(0);">
                    <span class="fa fa-bars"></span>
                </a>
            </li>
        </ul>
    </nav>
</header>
    <main>
        <div>
            <div class="container">
    <div class="row">
        <div class="ten offset-by-one columns content post">
            <div class="card">
                <h5 class="post-category">article</h5>
                <hr class="post-hr">
                <h4 class="post-title">What You Should Know About The Django User Model</h4>
                <div class="post-meta">
                    <ul>
                        <li>
                        <i class="fa fa-calendar"></i> Jul 8, 2022
                        </li>
                        <li>
                        <i class="fa fa-clock-o"></i>
                        2  minutes
                        </li>
                    </ul>
                </div>
                <p><img src="https://simpleisbetterthancomplex.com/media/2021/07/featured-user.jpg" alt="a" /></p>

<p>The <code class="language-plaintext highlighter-rouge">goal</code> of this article is to discuss the caveats of the default Django user model implementation and also to give you some advice on how to address them. It is important to know the limitations of the current implementation so to avoid the most common pitfalls.
w</p>
<blockquote>
  <p>Something to keep in mind is that the Django user model is heavily based on its initial implementation that is at least 16 years old. Because user and authentication is a core part of the majority of the web applications using Django, most of its quirks persisted on the subsequent releases so to maintain backward compatibility.</p>
</blockquote>

<p>The good news is that Django offers many ways to override and customize its default implementation so to fit your application needs. But some of those changes must be done right at the beginning of the project, otherwise it would be too much of a hassle to change the database structure after your application is in production.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.backends</span> <span class="kn">import</span> <span class="n">ModelBackend</span>


<span class="k">class</span> <span class="nc">CaseInsensitiveModelBackend</span><span class="p">(</span><span class="n">ModelBackend</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">UserModel</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">UserModel</span><span class="p">.</span><span class="n">USERNAME_FIELD</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">case_insensitive_username_field</span> <span class="o">=</span> <span class="s">'{}__iexact'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">UserModel</span><span class="p">.</span><span class="n">USERNAME_FIELD</span><span class="p">)</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">UserModel</span><span class="p">.</span><span class="n">_default_manager</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">case_insensitive_username_field</span><span class="p">:</span> <span class="n">username</span><span class="p">})</span>
        <span class="k">except</span> <span class="n">UserModel</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="c1"># Run the default password hasher once to reduce the timing
</span>            <span class="c1"># difference between an existing and a non-existing user (#20760).
</span>            <span class="n">UserModel</span><span class="p">().</span><span class="n">set_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user</span><span class="p">.</span><span class="n">check_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_can_authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">user</span>
</code></pre></div></div>

<p><strong>settings.py</strong></p>

<p>Please note that ‘mysite.core.backends.CaseInsensitiveModelBackend’ must be changed to the valid path, where you created the backends.py module.</p>

<p>It is important to have handled all conflicting users before changing the authentication backend because otherwise it could raise a 500 exception MultipleObjectsReturned.</p>

<h5 id="fixing-the-username-validation-to-use-accept-ascii-letters-only">Fixing the username validation to use accept ASCII letters only</h5>

<p>Here we can borrow the built-in UsernameField and customize it to append the ASCIIUsernameValidator to the list of validators:</p>

            </div>
            
            <div class="card post-author">
    <div class="author-pic">
        <img src="https://media-exp1.licdn.com/dms/image/C5103AQFq-B9N4IX4tw/profile-displayphoto-shrink_200_200/0/1552098921622?e=1654128000&v=beta&t=SYDHPBTycwsYR1EIuHLn2yopJDcjfvpapQdWM5Norw8" alt="">
    </div>
    <div class="author-info">
        <p class="name">By <strong>Sreekanth Reddy Balne</strong></p>
        <p class="bio">
            I'm a passionate software developer and researcher. I dig into Python, Django, PostgreSQL, AWS, RxJS, Typescript, Javascript, HTML, CSS, Terraform.
            <a href="/about">Read more.</a>
        </p>
        <p class="contact">
            
            <a href="https://github.com/sreekanthreddybalne" target="_blank">
                <span class="fa fa-github"></span>
            </a>
            
            <a href="https://stackoverflow.com/users/5710526/whitehat?tab=profile" target="_blank">
                <span class="fa fa-stack-overflow"></span>
            </a>
            
            <a href="https://www.linkedin.com/in/sbalne/" target="_blank">
                <span class="fa fa-linkedin"></span>
            </a>
            
            <a href="/contact" target="_blank">
                <span class="fa fa-envelope"></span>
            </a>
            
        </p>
    </div>
</div>
            
                <div id="disqus_thread"></div>
                <script>
                    /**
                    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
                    var disqus_config = function () {
                        this.page.url = "https://sreekanthreddybalne.github.io/articles/2022-04-02-welcome-to-jekyll.html";  // Replace PAGE_URL with your page's canonical URL variable
                        this.page.identifier = "/articles/2022-04-02-welcome-to-jekyll.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                    };
                    (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://sreekanthreddybalne-github-io.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            
        </div>
    </div>
</div>

        </div>
    </main>
    <script id="dsq-count-scr" src="//sreekanthreddybalne-github-io.disqus.com/count.js" async></script>
    <script src="/assets/js/site.js"></script>
</body>
</html>